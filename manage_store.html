<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Quản lý kho hàng</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="css/admin-page.css" />
    <script src="plugins/jquery/jquery-3.5.1.min.js"></script>
  </head>

  <body class="bdy">
    <!-- Load HTML header -->
    <header class="">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
        <a class="navbar-brand" href="#">Admin</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="#">Trang chủ <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="./manage_store.html">Kho hàng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./handle_orders.html">Đơn hàng</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <button type="button" class="btn btn-outline-info">Tài khoản</button>
          </form>
        </div>
        </div>
      </nav>
    </header>
    <!-- End HTML header -->

    <!-- HTML Main -->
    <main class="">
      
      <div class="container my-5">
        <div class="d-flex justify-content-between">

          <div class="">
            <h2>Quản lý kho hàng</h2>
          </div>
          
          <div class="">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-backdrop="static"><i class="fas fa-plus"></i> Thêm sản phẩm mới</button>
          </div>
        </div>
          
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg w-75" role="document" >
          <div class="modal-content">
            <div class="modal-header text-center">
              <h5 class="modal-title" id="exampleModalLabel">Đăng sản phẩm</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" >
              <div class="container-fluid">
      
                <form class="">
                  <div class="row bg-white p-3">
                    <div class="col-md-5">
                      <div class="form-group">
                        <!-- The expanding image container -->
                        <div class="">
                          <!-- Expanded image -->
                          <img id="expandedImg" style="width: 100%;" />
        
                          <!-- Image text -->
                          <div id="imgtext"></div>
                        </div>
                        <div class="gallery row"></div>
                        <label for="exampleFormControlFile1">Thêm ảnh</label>
                        <input
                          type="file"
                          multiple
                          id="gallery-photo-add"
                          class="form-control-file"
                          id="exampleFormControlFile1"
                        />
                      </div>
                    </div>
        
                    <div class="col-md-7 border-left pl-3">
                      <h4 class="form-group">Thông tin sản phẩm</h4>
                      <div class="form-group">
                        <!-- <div class="col"> -->
                          <label for="productname">Tên sản phẩm<span class="text-success">*</span></label>
                          <input
                            type="text"
                            class="form-control"
                            id="productname"
                            placeholder=""
                            value=""
                            required
                          />
                        <!-- </div> -->
                      </div>
        
                      <script type="text/javascript">
                        let brands = {
                          0: ["iPhone", "Samsung", "Nokia", "Sony", "Khác"],
                          1: ["Dell", "Macbook", "HP", "Asus", "Khác"],
                          2: ["Senheiser", "Bose", "Sony", "Beats", "Khác"]
                        }
                        function updateCategory() {
                          let categoryNode = document.getElementById("category");
                          let brandNode = document.getElementById("brand");
                          brandNode.innerHTML = '<option hidden="">Chọn thương hiệu</option>';
                          let categoryValue = categoryNode.value;
                          let selectedbrands = brands[categoryValue];
                          // console.log(categoryValue);
                          // console.log(selectedbrands);
                          for (let i = 0; i < selectedbrands.length; i++) {
                            let para = document.createElement("option");
                            var node = document.createTextNode(selectedbrands[i]);
                            para.appendChild(node);
                            para.value = i;
                    
                            brandNode.appendChild(para);
                          }
                        }
                      </script>
        
                      <div class="form-group">
                        <label for="category">Danh mục<span class="text-success">*</span></label>
                        <div class="">
                          <select class="form-control" id="category" onchange="updateCategory();">
                            <option hidden="">Chọn danh mục</option>
                          </select>
                        </div>
                      </div>  
        
                      <div class="form-group">
                        <label for="category">Thương hiệu<span class="text-success">*</span></label>
                        <div class="">
                          <select class="form-control" id="brand">
                          </select>
                        </div>
                      </div>  
        
                      <div class="form-group">
                        <label for="skunumber">SKU</label>
                        <input
                          type="text"
                          class="form-control"
                          id="skunumber"
                          placeholder="6706057278594"
                        />
                      </div>
        
                      <div class="form-group">
                        <label for="price">Giá (VND)<span class="text-success">*</span></label>
                        <input
                          type="text"
                          class="form-control"
                          id="price"
                          placeholder=""
                          required
                        />
                      </div>
                      <div class="form-group" id="specification">
                        <div class="d-flex justify-content-between">
                          <label for="specification">Thông số</label>
                          <button
                            class="btn btn-primary"
                            onclick="return addSpecification();"
                            id="addSpecificationButton"
                          >
                            Thêm thông số
                          </button>
                        </div>
                      </div>
        
                      <div class="form-group">
                        <label for="color">Màu</label>
                        <div id="colorBoard" class="row"></div>
                        <div id="colorForm" class="d-flex">
                          <div class="flex-fill">
                            <input
                              type="text"
                              class="form-control"
                              id="colorInput"
                              placeholder="Đỏ, vàng, xanh,..."
                              required
                            />
                          </div>
                          <div class="ml-3">
                            <button
                              class="btn btn-primary"
                              onclick="return addColorInput();"
                              id="addColor"
                            >
                              Thêm màu
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                    <div class="row">
                      <div class="form-group w-100 my-3">
                        <label for="productdetail">Thông tin chi tiết</label>
                        <textarea name="productdetail"></textarea>
                      </div>
                      <div class="form-group w-100">
                        <label for="description">Mô tả sản phẩm</label>
                        <textarea name="description"></textarea>
                      </div>
        
                    </div>
                  </form>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button class="btn btn-primary" type="button" onclick="return handleSubmit();">
                  Thêm sản phẩm
                </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Store -->
      <div class="table-responsive mt-3">
        <table class="table table-bordered bg-white">
          <thead id="table-header" class="text-center text-nowrap">
          </thead>
          <script>
            $(document).ready(function() {
              let columnsName = [
                "Hình ảnh", 
                "Tên sản phẩm", 
                "Danh mục", 
                "Thương hiệu",
                "Giá (VND)", 
                "Thao tác"
              ];

            let newTr = $('<tr></tr>');
            $.each(columnsName, function(key, val) {
              let newTh = $('<th scope="col" id="' + key + '">' + val + '</th>');
              newTr.append(newTh);
            });
            $("#table-header").append(newTr);

            });
          </script>
          <tbody id="table-body">
            
          </tbody>
          <script>
            $(document).ready(function() {
              let productIds = ["48886153", "29964500", "45339109", "36699543", "36700352", "34016501", "53398913", "53097934", "56307922", "44241660"]
              productIds.forEach(productId => {
                $.ajax({
                  url: "https://tiki.vn/api/v2/products/" + productId,
                  dataType: "json",
                  success: function(product) {
                    let tr = $('<tr></tr>');
                    tr.append('<td class="text-center"><img class="w-75" src="' + product.thumbnail_url + '"/></td>');
                    tr.append('<td>' + product.name + '</td>');
                    tr.append('<td>' + product.categories.name + '</td>');
                    tr.append('<td>' + product.brand.name + '</td>');
                    tr.append('<td class="text-right">' + parseInt(product.price).toLocaleString('vi-VN') + '</td>');
                    tr.append('<td class="text-nowrap"><button class="btn btn-primary text-nowrap"><i class="fas fa-store"></i> Bày bán</button> <button class="btn btn-danger text-nowrap"><i class="fas fa-store-slash"></i> Gỡ xuống</button></td>');
                    $("#table-body").append(tr);
                  }
                })
              });
            });
          </script>
        </table>
        </div>
      </div>

    </main>
    <!-- End HTML Main -->

    <!-- HTML Footer -->
    <script
      language="javascript"
      type="text/javascript"
      src="./js/footer.js"
    ></script>
    <!-- End HTML Footer -->

    
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/index.js"></script>
    <script src="js/data.js"></script>

  <script src="https://cdn.ckeditor.com/4.14.1/standard/ckeditor.js"></script>

    <script>
    CKEDITOR.replace( 'productdetail' );
    CKEDITOR.replace( 'description' );
  </script>
  <script>
    function addSpecification() {
      $("#specification").append(`<div class="d-flex mt-3">
              <div class="flex-fill mr-3">
                <input type="text" class="form-control" placeholder="Tên">
              </div>
              <div class="flex-fill mr-3">
                <input type="text" class="form-control" placeholder="Giá trị">
              </div>
              <div class="">
                <button type="button" onclick="handleRemoveParent(this);" class="btn btn-danger">Xóa</button>
              </div>
            </div>`);
      return false;
    }

    function addColorInput() {
      let color = $("#colorInput").val();
      if (color !== "") {
        $("#colorBoard").append(`<div class="col-6 mb-3 d-flex justify-content-between" >
              <div class="">
                <input type="text" class="form-control" value="` + color + `">
              </div>
              <div>
                <button type="button" onclick="handleRemoveParent(this)" class="btn btn-danger">Xóa</button>
              </div>
            </div>`);
      }
      $("#colorInput").val("");
      return false;
    }

    function handleRemoveParent(child) {
      $(child).parent().parent().remove();
    }

    $(function() {
      // Multiple images preview in browser
      var imagesPreview = function(input, placeToInsertImagePreview) {

        if (input.files) {
          var filesAmount = input.files.length;

          for (i = 0; i < filesAmount; i++) {
            var reader = new FileReader();

            reader.onload = function(event) {
              let newImg = $($.parseHTML('<img class="previewImgs" style="max-width:100%;" onclick="expandImg(this);">')).attr('src', event.target.result);
              let newDiv = $($.parseHTML('<div class="col-3">')).append(newImg);
              newDiv.appendTo(placeToInsertImagePreview);
              // $($.parseHTML('<img>')).attr('src', event.target.result).appendTo(placeToInsertImagePreview);
            }

            reader.readAsDataURL(input.files[i]);
          }
          // return true; //successful case
        }
        // return false; //failed case 
      };

      $('#gallery-photo-add').on('change', async function() {
        let resultCode = imagesPreview(this, 'div.gallery');
        setTimeout(() => expandImg(document.getElementsByClassName("previewImgs")[0]), 1000);
      });
    });
    
    function expandImg(imgs) {
      // Get the expanded image
      var expandImg = document.getElementById("expandedImg");
      // Get the image text
      var imgText = document.getElementById("imgtext");
      // Use the same src in the expanded image as the image being clicked on from the grid
      expandImg.src = imgs.src;
      // Use the value of the alt attribute of the clickable image as text inside the expanded image
      imgText.innerHTML = imgs.alt;
      // Show the container element (hidden with CSS)
      expandImg.parentElement.style.display = "block";
    }

    let categories = ["Điện thoại", "Laptop", "Tai nghe"];
		let categoryNode = document.getElementById("category");
		for (let i = 0; i < categories.length; i++) {
			let para = document.createElement("option");
			var node = document.createTextNode(categories[i]);
			para.appendChild(node);
			para.value = i;

			categoryNode.appendChild(para);
		}

    function handleSubmit() {
      alert("Đăng sản phẩm thành công!");
      window.location.reload();
    }
    </script>
  </body>
</html>
